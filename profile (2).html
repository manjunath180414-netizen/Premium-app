<!DOCTYPE html>
<html>
<head>
  <title>Profile - HIS Academy</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    body{
      margin:0;
      font-family:Poppins, sans-serif;
      background:linear-gradient(135deg,#0f0f1a,#1a1a2e);
      color:white;
      padding-bottom:80px;
    }

    .container{
      padding:20px;
      max-width:1000px;
      margin:auto;
    }

    h2{
      color:#FFD700;
      margin-bottom:20px;
    }

    .card{
      background:#111827;
      padding:20px;
      border-radius:18px;
      margin-bottom:20px;
      box-shadow:0 0 25px rgba(255,215,0,0.15);
    }

    .highlight{
      color:#FFD700;
      font-weight:bold;
    }

    .status-paid{
      color:#00ff88;
      font-weight:bold;
    }

    .status-unpaid{
      color:#ff4d4d;
      font-weight:bold;
    }

    .progress-bar{
      width:100%;
      background:#1f2937;
      border-radius:10px;
      overflow:hidden;
      margin-top:10px;
    }

    .progress-fill{
      height:12px;
      background:#FFD700;
      width:0%;
      transition:width 1s ease;
    }

    .btn{
      width:100%;
      padding:12px;
      border-radius:10px;
      border:none;
      font-weight:bold;
      cursor:pointer;
      margin-top:15px;
    }

    .primary-btn{
      background:#FFD700;
      color:black;
    }

    .secondary-btn{
      background:#1f2937;
      color:white;
      border:1px solid #FFD700;
    }

    /* Bottom Navigation */
.bottom-nav{
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  height:70px;
  background:#111827;
  display:flex;
  justify-content:space-around;
  align-items:center;
  box-shadow:0 -5px 20px rgba(255,215,0,0.15);
  z-index:1000;
}

.nav-item{
  flex:1;
  text-align:center;
  font-size:12px;
  color:#aaa;
  cursor:pointer;
}

.nav-item span{
  display:block;
  font-size:20px;
  margin-bottom:2px;
}

.nav-item.active{
  color:#FFD700;
}


  </style>
</head>
<body>

<div class="container">

  <h2>Student Profile</h2>

  <!-- Student Info -->
  <div class="card">
    <p><span class="highlight">Name:</span> <span id="name"></span></p>
    <p><span class="highlight">Email:</span> <span id="email"></span></p>
    <p><span class="highlight">Phone:</span> <span id="phone"></span></p>
    <p><span class="highlight">Medium:</span> <span id="medium"></span></p>
    <p><span class="highlight">Joined On:</span> <span id="joined"></span></p>
  </div>

  <!-- Course Status -->
  <div class="card">
    <p><span class="highlight">Course:</span> SSLC 2026 Crash Course</p>
    <p><span class="highlight">Payment Status:</span> 
      <span id="paymentStatus"></span>
    </p>
<div id="paymentSection"></div>
<div id="requestModal" style="
display:none;
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
background:rgba(0,0,0,0.7);
justify-content:center;
align-items:center;
">

  <div style="
    background:#111827;
    padding:25px;
    border-radius:20px;
    width:90%;
    max-width:400px;
    box-shadow:0 0 25px rgba(255,215,0,0.2);
  ">

    <h3 style="color:#FFD700;">Payment Verification</h3>

    <p style="font-size:14px; line-height:1.6;">
      Hello HiS Academy,<br><br>
      I have paid the crash course fees. Kindly verify and give access.
    </p>

    <div id="studentInfo" style="margin-top:10px; font-size:14px;"></div>

    <button onclick="submitRequest()" style="
      width:100%;
      margin-top:15px;
      padding:12px;
      border-radius:10px;
      border:none;
      background:#FFD700;
      color:black;
      font-weight:bold;
      cursor:pointer;">
      Submit Request
    </button>

  </div>

</div>

    <div id="progressSection" style="display:none;">
      <p><span class="highlight">Course Progress</span></p>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <p id="progressText"></p>
    </div>
    <button onclick="openTimetable()" 
style="
width:100%;
padding:14px;
margin-top:12px;
border-radius:12px;
border:none;
background:#1f2937;
color:#FFD700;
font-weight:bold;
cursor:pointer;
border:2px solid #FFD700;">
üìÖ Study Master Plan
</button>

<button class="btn secondary-btn" onclick="logoutUser()">
  Logout
</button>
    

    <button id="actionBtn" class="btn primary-btn"></button>
  </div>

  <!-- Performance -->
  <div class="card" id="performanceCard" style="display:none;">
    <p><span class="highlight">Total Study Hours:</span> <span id="studyHours">0</span></p>
    <p><span class="highlight">Live Classes Attended:</span> 0</p>
    <p><span class="highlight">Recorded Classes Watched:</span> 0</p>
    <p><span class="highlight">Badge:</span> <span id="badge"></span></p>
  </div>

</div>

<!-- Bottom Navigation -->
<div class="bottom-nav">

  <div class="nav-item" onclick="goDashboard()">
    <span>üè†</span>
    Dashboard
  </div>

  <div class="nav-item" onclick="goLive()">
    <span>üî¥</span>
    Live
  </div>

  <div class="nav-item" onclick="goNotes()">
    <span>üìÑ</span>
    Notes
  </div>

  <div class="nav-item" onclick="goRecorded()">
    <span>üé•</span>
    Recorded
  </div>

  <div class="nav-item active">
    <span>üë§</span>
    Profile
  </div>

</div>


<script>

  const firebaseConfig = {
    apiKey: "AIzaSyCehyZQukDfslKTY_u9yXcUrzGtMNHvuPA",
    authDomain: "his-academy.firebaseapp.com",
    projectId: "his-academy"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  auth.onAuthStateChanged((user)=>{
    if(user){

      db.collection("students").doc(user.uid).get()
      .then(doc=>{
        if(!doc.exists){
          window.location.href="login.html";
        }

        const data = doc.data();

        document.getElementById("name").innerText = data.name;
        document.getElementById("email").innerText = data.email;
        document.getElementById("phone").innerText = data.phone;
        document.getElementById("medium").innerText = data.medium;

        if(data.joinedOn){
          document.getElementById("joined").innerText =
            new Date(data.joinedOn.seconds * 1000).toLocaleDateString();
        }

        const actionBtn = document.getElementById("actionBtn");

        if(data.paymentStatus === "paid"){

          document.getElementById("paymentStatus").innerHTML =
            "<span class='status-paid'>Active Student ‚úÖ</span>";

          document.getElementById("performanceCard").style.display="block";
          document.getElementById("progressSection").style.display="block";

          const hours = data.totalStudyHours || 0;
          document.getElementById("studyHours").innerText = hours;

          // Simple progress calculation
          let progress = Math.min((hours / 100) * 100, 100);
          document.getElementById("progressFill").style.width = progress + "%";
          document.getElementById("progressText").innerText =
            Math.round(progress) + "% Completed";

          // Badge Logic
          let badge = "Beginner üü¢";
          if(hours > 20) badge = "Top Performer üèÜ";
          else if(hours > 5) badge = "Consistent Learner ü•à";

          document.getElementById("badge").innerText = badge;

          actionBtn.innerText = "Go To Dashboard";
          actionBtn.onclick = () => window.location.href="dashboard.html";

        } else {

          document.getElementById("paymentStatus").innerHTML =
            "<span class='status-unpaid'>Not Enrolled ‚ùå</span>";

          actionBtn.innerText = "View Available Courses";
          actionBtn.onclick = () => window.location.href="courses.html";

        }

      });

    } else {
      window.location.href="login.html";
    }
  });

  function goDashboard(){ window.location.href="dashboard.html"; }
  function goLive(){ window.location.href="live.html"; }
  function goNotes(){ window.location.href="notes.html"; }
  function goRecorded(){ window.location.href="recorded.html"; }
function logoutUser(){
  firebase.auth().signOut()
  .then(() => {
    window.location.href = "index.html";
  })
  .catch((error) => {
    alert("Error logging out. Try again.");
  });
}
function openTimetable(){
  window.location.href = "timetable.html";
}
let currentUser;

auth.onAuthStateChanged(async(user)=>{
  if(!user){
    window.location.href="login.html";
    return;
  }

  currentUser = user;

  const doc = await db.collection("students").doc(user.uid).get();
  const data = doc.data();

  renderPaymentUI(data);
});


function renderPaymentUI(data){

  const container = document.getElementById("paymentSection");

  // CASE 1 ‚Äî NOT PAID
  if(!data.paymentStatus || data.paymentStatus === "not_paid"){

    container.innerHTML = `
      <button onclick="openRequestScreen()" 
      style="
      width:100%;
      padding:14px;
      margin-top:15px;
      border-radius:12px;
      border:none;
      background:#1f2937;
      color:#FFD700;
      font-weight:bold;
      cursor:pointer;
      border:2px solid #FFD700;">
      üí≥ Did You Pay? Request for Verification
      </button>
    `;
  }

  // CASE 2 ‚Äî PENDING
  else if(data.paymentStatus === "pending"){

    container.innerHTML = `
      <div style="
        margin-top:15px;
        padding:15px;
        border-radius:12px;
        background:#1f2937;
        border:2px solid #cc8800;
        color:#FFD700;
        font-weight:bold;
      ">
        ‚è≥ Requesting for Approval.<br>
        Kindly wait up to 12 hours.
      </div>
    `;
  }

  // CASE 3 ‚Äî PAID
  else if(data.paymentStatus === "paid"){

    container.innerHTML = `
      <div style="
        margin-top:15px;
        padding:15px;
        border-radius:12px;
        background:#1f2937;
        border:2px solid #00aa55;
        color:#00ff99;
        font-weight:bold;
      ">
        ‚úÖ Payment Verified. Access Granted.
      </div>
    `;
  }
}
function openRequestScreen(){

  const user = currentUser;

  db.collection("students").doc(user.uid).get().then(doc=>{
    const data = doc.data();

    document.getElementById("studentInfo").innerHTML = `
      <strong>Name:</strong> ${data.name}<br>
      <strong>Email:</strong> ${data.email}<br>
      <strong>Phone:</strong> ${data.phone}
    `;
  });

  document.getElementById("requestModal").style.display="flex";
}


async function submitRequest(){

  await db.collection("students").doc(currentUser.uid).update({
    paymentStatus:"pending",
    requestSubmitted:true,
    requestTime: firebase.firestore.FieldValue.serverTimestamp()
  });

  document.getElementById("requestModal").style.display="none";

  renderPaymentUI({paymentStatus:"pending"});
}

</script>

</body>
</html>

